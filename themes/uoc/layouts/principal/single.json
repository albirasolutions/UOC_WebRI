{{ $.Scratch.Set "len" 0 }}
{{ range $i, $s := .Site.AllPages }}
	{{- if and ( or (eq $s.Type "solucio_tec") (eq $s.Type "patent") (eq $s.Type "servei") (eq $s.Type "spin_off") (eq $s.Type "noticies") (eq $s.Type "esdeveniments")) (ne $s.File.UniqueID "")}}
	{{ $.Scratch.Set "len" (add ($.Scratch.Get "len") 1) }}
	{{end}}
{{end}}
{{ $.Scratch.Set "counter" 0 }}
[{{ range $i, $s := .Site.AllPages }}{{- if and ( or (eq $s.Type "solucio_tec") (eq $s.Type "patent") (eq $s.Type "servei") (eq $s.Type "spin_off") (eq $s.Type "noticies") (eq $s.Type "esdeveniments")) (ne $s.File.UniqueID "")}}{
	  {{ $.Scratch.Set "counter" (add ($.Scratch.Get "counter") 1) }}
		"type" : "add",
		"id" : {{ $s.File.UniqueID | jsonify }},
		"fields" : {
			{{- if and (isset $s.Params "language") (ne $s.Params.language nil) }}
			"idioma": {{$s.Params.language | jsonify}},{{- end }}{{- if and (isset $s.Params "title") (ne $s.Params.title nil) }}
			"title": {{$s.Params.title | jsonify}},{{- end }}{{- if and (isset $s.Params "general") (ne $s.Params.general nil) }}{{$general := $s.Params.general }}{{- if or (eq $s.Type "solucio_tec") (eq $s.Type "patent") (eq $s.Type "servei") (eq $s.Type "spin_off") }}
			"name": {{if eq $s.Type "solucio_tec" }}{{$general.nom_solucio | jsonify}}
			{{else if eq $s.Type "patent"}}
				{{$general.nom_patent | jsonify}}
			{{else if eq $s.Type "servei"}}
				{{$general.nom_servei | jsonify}}
			{{else}}
				{{$general.nom_spinoff | jsonify}}
			{{end}},

			{{with .Params.general.text_breu}}"text_breu": {{.}} | jsonify}},{{end}}
			{{with .Params.general.slogan}}"eslogan": {{.}} | jsonify}},{{end}}

			"imatge_alt": {{$s.Params.title | jsonify}},
			"imatge_title": {{$s.Params.title | jsonify}},
			"imatge_url": {{if ne $general.img_background nil }}{{$general.img_background | jsonify}}{{else}}""{{end}},
			"centre": {{if or (eq $s.Type "servei") (eq $general.centre nil)}}""{{else}}{{$general.centre | jsonify}}{{end}},
			"sector": {{if ne $general.sector nil }} {{$general.sector | jsonify}}{{else}}""{{end}},
			"logo_url":
			{{if ne $general.logo nil }}{{$general.logo | jsonify}}
			{{else}}""
			{{end}},{{$keywords := slice ""}}
			{{- range $k := $general.keywords}}
				{{if isset $k "value"}}{{$keywords := slice $k.value }}
				{{end}}
			{{end}}
			{{- if ne $keywords nil }}
			"keywords": {{$keywords | jsonify}},
			{{end}}
			{{$xarxesList := slice ""}}{{$xarxesAddress := slice ""}}{{- range $x := $general.xarxes}}{{$xarxesList := slice $x.xarxa }}{{$xarxesAddress := slice $x.address }}
			{{end}}
			{{- if ne $xarxesList nil }}
			{{end}}
			"imatge_alt": {{$s.Params.title | jsonify}},
			"imatge_title": {{$s.Params.title | jsonify}},{{end}}{{- end }}
			
			{{if eq $s.Type "solucio_tec"}}
				{{with .Params.sobre_tecnologia}}"sobre_tec_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.sobre_tecnologia}}"sobre_tec_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
			{{else if eq $s.Type "patent"}}
				{{with .Params.sobre_patent}} "sobre_pat_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.sobre_patent}} "sobre_pat_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
			{{else if eq $s.Type "servei"}}
				{{with .Params.sobre_servei}} "sobre_servei_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.sobre_servei}} "sobre_servei_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
			{{else}}
				{{with .Params.sobre_spinoff}} "sobre_spin_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.sobre_spinoff}} "sobre_spin_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
			{{end}}
			
			{{if or (eq $s.Type "solucio_tec") (eq $s.Type "pantent")}}
				{{with .Params.aspectes_innovadors}}"asp_innov_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.aspectes_innovadors}}"asp_innov_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
				{{with .Params.aplicacions}}"app_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.aplicacions}}"app_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
			{{end}}
			{{if or (eq $s.Type "servei") (eq $s.Type "spin_off")}}
				{{with .Params.casos_exit}}"casos_exit_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.casos_exit}}"casos_exit_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
				{{with .Params.casos_exit}}"casos_exit_img": {{(index . 0).img | jsonify}},{{end}}
				{{with .Params.casos_exit}}"casos_exit_url_success": {{(index . 0).url_success | jsonify}},{{end}}
			{{end}}
			{{if eq $s.Type "spin_off"}}
				{{with .Params.productes_serveis}}"productes_serveis_titol": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.productes_serveis}}"productes_serveis_descripcio": {{(index . 0).descripcio | jsonify}},{{end}}
				{{with .Params.clients}}"clients_title": {{(index . 0).titol | jsonify}},{{end}}
				{{with .Params.clients}}"clients_descripcio": {{(index . 0).titol | jsonify}},{{end}}
			{{end}}
			{{- if and (isset $s.Params "grups_recerca") (ne $s.Params.grups_recerca nil) }}{{$grupsList := slice ""}}{{$invList := slice ""}}{{range $gr := $s.Params.grups_recerca }}{{$grupsList := $gr.grups }}{{$invList := $gr.investigadors }}{{end}}{{if ne $grupsList nil}}
			"grups": {{$grupsList | jsonify}},{{end}}{{if ne $invList nil}}
			"investigadors": {{$invList | jsonify}},{{end}}{{end}}{{- if and (isset $s.Params "contacte") (ne $s.Params.contacte nil) }}{{$contacte := index $s.Params.contacte 0}}{{- if ne $contacte.email nil}}
			"contacts_email" : {{ $contacte.email | jsonify }},{{end}}{{- if ne $contacte.address nil}}
			"contacts_address" : {{ $contacte.address | jsonify }},{{end}}{{- if ne $contacte.text nil}}
			"contacts_name" : {{ $contacte.text | jsonify }},{{end}}{{- if ne $contacte.telefon nil}}
			"contacts_phone" : {{ $contacte.telefon | jsonify }},{{end}}{{end}}
			"content" : "transfer",
			"content_encoding": "utf-8",
			"content_type" : {{$s.Type | jsonify}},
			"resourcename" : {{$s.Params.title | jsonify}},
			"url" : {{ $s.Permalink | jsonify }}
		}
	}{{ if ne ($.Scratch.Get "len") ($.Scratch.Get "counter")}},{{end}}{{end}}{{end}}]
